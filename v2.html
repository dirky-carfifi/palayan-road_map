<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Palayan Road Hazard Map - Custom Image</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        display: flex;
        flex-direction: column;
        height: 100vh;
        overflow: hidden;
        background: #2c3e50;
      }

      header {
        background: linear-gradient(135deg, #8b2c2a 0%, #6b2120 100%);
        color: #ebd0a2;
        padding: 15px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        z-index: 1000;
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .logo h1 {
        font-size: 1.8rem;
        font-weight: 700;
      }

      .logo i {
        font-size: 2rem;
      }

      .search-container {
        display: flex;
        gap: 10px;
      }

      .search-container input {
        padding: 10px 15px;
        border: none;
        border-radius: 20px;
        width: 300px;
        font-size: 1rem;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        background: #f8f4e9;
        color: #333;
      }

      .search-container button {
        padding: 10px 20px;
        border: none;
        border-radius: 20px;
        background: #947cca;
        color: #fff;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.3s;
      }

      .search-container button:hover {
        background: #7c65b3;
      }

      .main-container {
        display: flex;
        flex: 1;
        overflow: hidden;
        position: relative;
      }

      .sidebar {
        width: 300px;
        background: #ebd0a2;
        padding: 20px;
        overflow-y: auto;
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        z-index: 900;
        transition: transform 0.3s ease;
        position: relative;
        height: 100%;
      }

      .sidebar.hidden {
        transform: translateX(-100%);
      }

      .toggle-sidebar {
        position: absolute;
        top: 80px;
        left: 300px;
        width: 30px;
        height: 40px;
        background: #8b2c2a;
        color: #ebd0a2;
        border: none;
        border-radius: 0 5px 5px 0;
        cursor: pointer;
        z-index: 950;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: left 0.3s ease;
      }

      .toggle-sidebar.sidebar-hidden {
        left: 0;
      }

      .sidebar h2 {
        margin-bottom: 15px;
        color: #8b2c2a;
        border-bottom: 2px solid rgba(139, 44, 42, 0.3);
        padding-bottom: 10px;
      }

      .categories {
        margin-bottom: 20px;
      }

      .category {
        display: flex;
        align-items: center;
        padding: 10px;
        margin-bottom: 8px;
        border-radius: 5px;
        cursor: pointer;
        transition: background 0.3s;
        color: #333;
      }

      .category:hover {
        background: rgba(139, 44, 42, 0.1);
      }

      .category i {
        margin-right: 10px;
        color: #8b2c2a;
        width: 20px;
        text-align: center;
      }

      .category.active {
        background: rgba(139, 44, 42, 0.2);
        font-weight: 600;
        color: #8b2c2a;
      }

      .places-list {
        margin-top: 20px;
      }

      .place-item {
        display: flex;
        padding: 12px;
        margin-bottom: 10px;
        border-radius: 5px;
        background: rgba(255, 255, 255, 0.7);
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
      }

      .place-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        background: #fff;
      }

      .place-info {
        flex: 1;
      }

      .place-info h3 {
        font-size: 1rem;
        margin-bottom: 5px;
        color: #8b2c2a;
      }

      .place-info p {
        font-size: 0.85rem;
        color: #666;
      }

      .map-container {
        flex: 1;
        position: relative;
      }

      #map {
        height: 100%;
        width: 100%;
        background-color: #d4c9a6; /* Fallback color if image doesn't load */
      }

      .map-controls {
        position: absolute;
        top: 20px;
        right: 20px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        z-index: 800;
      }

      .control-btn {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: #8b2c2a;
        border: none;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        font-size: 1.2rem;
        color: #ebd0a2;
        transition: background 0.3s;
      }

      .control-btn:hover {
        background: #6b2120;
      }

      .map-legend {
        position: absolute;
        bottom: 20px;
        left: 20px;
        background: rgba(235, 208, 162, 0.9);
        padding: 10px 15px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        z-index: 800;
        border: 1px solid #8b2c2a;
      }

      .map-legend h3 {
        font-size: 0.9rem;
        margin-bottom: 8px;
        color: #8b2c2a;
        text-align: center;
      }

      .legend-item {
        display: flex;
        align-items: center;
        margin-bottom: 5px;
      }

      .legend-color {
        width: 15px;
        height: 15px;
        border-radius: 50%;
        margin-right: 8px;
      }

      .legend-label {
        font-size: 0.8rem;
        color: #333;
      }

      .info-panel {
        position: absolute;
        bottom: 20px;
        right: 20px;
        background: rgba(235, 208, 162, 0.95);
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        z-index: 800;
        max-width: 300px;
        display: none;
        border: 1px solid #8b2c2a;
      }

      .info-panel h3 {
        margin-bottom: 10px;
        color: #8b2c2a;
      }

      .info-panel p {
        font-size: 0.9rem;
        color: #333;
        margin-bottom: 10px;
      }

      .info-panel .close-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        background: none;
        border: none;
        font-size: 1.2rem;
        cursor: pointer;
        color: #8b2c2a;
      }

      .hazard-tag {
        display: inline-block;
        padding: 3px 8px;
        border-radius: 4px;
        margin-right: 5px;
        margin-bottom: 5px;
        font-size: 0.8rem;
        color: black;
      }

      .hazard-fire {
        background-color: #f37106;
      }

      .hazard-flood {
        background-color: #008cff;
      }

      .hazard-structural {
        background-color: #ffe600;
      }

      .hazard-road {
        background-color: #464040;
      }

      .hazard-environmental {
        background-color: #00aa69;
      }

      /* Street View Modal */
      .street-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 2000;
        justify-content: center;
        align-items: center;
      }

      .street-modal.active {
        display: flex;
      }

      .modal-content {
        background: white;
        padding: 20px;
        border-radius: 8px;
        max-width: 90%;
        max-height: 90%;
        overflow: auto;
        position: relative;
      }

      .modal-close {
        position: absolute;
        top: 10px;
        right: 10px;
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: #8b2c2a;
      }

      .street-image {
        max-width: 100%;
        max-height: 70vh;
        margin-bottom: 15px;
        border-radius: 5px;
      }

      .street-details {
        margin-top: 15px;
      }

      .fullscreen-toggle {
        position: absolute;
        top: 20px;
        left: 20px;
        z-index: 800;
        background: #8b2c2a;
        color: #ebd0a2;
        border: none;
        border-radius: 4px;
        padding: 8px 12px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 5px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      }

      .fullscreen-toggle:hover {
        background: #6b2120;
      }

      @media (max-width: 768px) {
        .sidebar {
          position: absolute;
          height: 100%;
          z-index: 900;
          transform: translateX(-100%);
        }

        .sidebar.visible {
          transform: translateX(0);
        }

        .toggle-sidebar {
          left: 0;
          top: 70px;
        }

        .search-container input {
          width: 180px;
        }

        .map-legend {
          max-width: 150px;
          bottom: 70px;
        }

        .info-panel {
          max-width: 85%;
          right: 10px;
          bottom: 10px;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <div class="logo">
        <i class="fas fa-map-marked-alt"></i>
        <h1>Palayan Road Hazard Map</h1>
      </div>
      <div class="search-container">
        <input
          type="text"
          id="search-input"
          placeholder="Search for hazards..."
        />
        <button id="search-btn"><i class="fas fa-search"></i> Search</button>
      </div>
    </header>

    <div class="main-container">
      <button class="toggle-sidebar" id="toggle-sidebar">
        <i class="fas fa-chevron-left"></i>
      </button>

      <div class="sidebar" id="sidebar">
        <h2>Hazard Categories</h2>
        <div class="categories">
          <div class="category active" data-category="all">
            <i class="fas fa-layer-group"></i>
            <span>All Section</span>
          </div>
          <div class="category" data-category="fire">
            <i class="fas fa-fire"></i>
            <span>Section 1</span>
          </div>
          <div class="category" data-category="flood">
            <i class="fas fa-water"></i>
            <span>Section 2</span>
          </div>
          <div class="category" data-category="structural">
            <i class="fas fa-building"></i>
            <span>Section 3</span>
          </div>
          <div class="category" data-category="road">
            <i class="fas fa-road"></i>
            <span>Section 4</span>
          </div>
          <div class="category" data-category="environmental">
            <i class="fas fa-tree"></i>
            <span>Section 5</span>
          </div>
        </div>

        <h2>Reported Hazards</h2>
        <div class="places-list">
          <div class="place-item" data-id="1">
            <div class="place-info">
              <h3>Flooded Street - Main Road</h3>
              <p>High water level during heavy rains</p>
            </div>
          </div>
          <div class="place-item" data-id="2">
            <div class="place-info">
              <h3>Fire Hazard - Market Area</h3>
              <p>Overloaded electrical circuits</p>
            </div>
          </div>
          <div class="place-item" data-id="3">
            <div class="place-info">
              <h3>Unstable Structure - Old Building</h3>
              <p>Cracks in foundation and walls</p>
            </div>
          </div>
          <div class="place-item" data-id="4">
            <div class="place-info">
              <h3>Slippery Road - Mountain Path</h3>
              <p>Landslide risk during rainy season</p>
            </div>
          </div>
        </div>
      </div>

      <div class="map-container">
        <div id="map"></div>

        <button class="fullscreen-toggle" id="fullscreen-toggle">
          <i class="fas fa-expand"></i> Full Screen
        </button>

        <div class="map-controls">
          <button class="control-btn" id="zoom-in">
            <i class="fas fa-plus"></i>
          </button>
          <button class="control-btn" id="zoom-out">
            <i class="fas fa-minus"></i>
          </button>
          <button class="control-btn" id="locate-me">
            <i class="fas fa-location-arrow"></i>
          </button>
          <button class="control-btn" id="report-btn">
            <i class="fas fa-exclamation-circle"></i>
          </button>
        </div>

        <div class="map-legend">
          <h3>Hazard Types</h3>
          <div class="legend-item">
            <div class="legend-color" style="background-color: #f30a06"></div>
            <span class="legend-label">Fire Hazard</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background-color: #4c00ff"></div>
            <span class="legend-label">Flood Risk</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background-color: #ff9900"></div>
            <span class="legend-label">Structural Issue</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background-color: #555555"></div>
            <span class="legend-label">Road Hazard</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background-color: #00aa00"></div>
            <span class="legend-label">Environmental Risk</span>
          </div>
        </div>

        <div class="info-panel" id="info-panel">
          <button class="close-btn" id="close-info">
            <i class="fas fa-times"></i>
          </button>
          <h3 id="place-name">Hazard Name</h3>
          <p id="place-address">Location will appear here</p>
          <p id="place-description">Description will appear here</p>
          <div id="hazard-tags"></div>
          <button
            id="view-street-btn"
            style="
              margin-top: 10px;
              padding: 8px 12px;
              background: #8b2c2a;
              color: white;
              border: none;
              border-radius: 4px;
              cursor: pointer;
            "
          >
            <i class="fas fa-street-view"></i> View Street Details
          </button>
        </div>
      </div>
    </div>

    <!-- Street View Modal -->
    <div class="street-modal" id="street-modal">
      <div class="modal-content">
        <button class="modal-close" id="modal-close">
          <i class="fas fa-times"></i>
        </button>
        <h2 id="street-name">Street Name</h2>
        <img id="street-image" class="street-image" src="" alt="Street view" />
        <div class="street-details">
          <h3>Hazards Identified</h3>
          <div id="modal-hazards"></div>
          <p id="street-description" style="margin-top: 15px"></p>
        </div>
      </div>
    </div>

    <script>
      // Initialize map with image overlay
      const map = L.map("map", {
        crs: L.CRS.Simple, // Use simple coordinate system for image maps
        minZoom: -2,
        maxZoom: 4,
      }).setView([0, 0], 0);

      // Define the image bounds and overlay - REPLACE WITH YOUR IMAGE PATH
      const imageUrl = "img/1.jpeg";
      const imageBounds = [
        [-100, -100],
        [3000, 4000],
      ];

      // Create custom image overlay
      const customImageLayer = L.imageOverlay(imageUrl, imageBounds);

      // Add custom image layer
      customImageLayer.addTo(map);
      map.fitBounds(imageBounds);

      // Check if image loaded successfully
      const img = new Image();
      img.onload = function () {
        console.log("Custom map image loaded successfully");
      };
      img.onerror = function () {
        console.error("Custom map image failed to load");
        alert("Custom map image failed to load. Please check the image path.");
      };
      img.src = imageUrl;

      // Sample hazard data
      const hazards = [
        {
          id: 1,
          name: "Section 1 (Fire Prone)",
          description:
            "Overloaded electrical circuits and crowded conditions create significant fire risk. No visible fire extinguishers in the area.",
          address: "Market Area, Palayan Road, Philippines",
          category: "fire",
          lat: 2,
          lng: 137.9,
          severity: "medium",
          tags: ["fire", "electrical", "crowded"],
          streetView: "img/2.jpg",
          streetName: "Market Area, Palayan Road",
          streetDescription:
            "Crowded market area with visible electrical wiring issues. Limited emergency access routes.",
        },
        {
          id: 2,
          name: "Section 2 (Flood Prone) ",
          description:
            "This area experiences frequent flooding during heavy rains, with water levels reaching up to 1 meter. Avoid during stormy weather.",
          address: "Main Road, Palayan Road, Philippines",
          category: "flood",
          lat: 0,
          lng: 132,
          severity: "high",
          tags: ["flood", "water", "accessibility"],
          streetView: "img/3.jpg",
          streetName: "Main Road, Palayan Road",
          streetDescription:
            "This street is prone to flooding during the rainy season. Drainage systems are inadequate for heavy rainfall.",
        },
        {
          id: 3,
          name: "Section 3 (Unstable Structure)",
          description:
            "Building shows significant structural cracks. Appears abandoned but still accessible to the public.",
          address: "123 Old Street, Palayan Road, Philippines",
          category: "structural",
          lat: 2,
          lng: 150,
          severity: "high",
          tags: ["structural", "collapse", "building"],
          streetView: "img/6.jpeg",
          streetName: "Old Street, Palayan Road",
          streetDescription:
            "Dilapidated building with visible structural damage. Potential collapse risk during seismic activity or heavy storms.",
        },
        {
          id: 4,
          name: "Section 4 (Slippery Road)",
          description:
            "Steep, unpaved road becomes extremely slippery when wet. Multiple accidents reported in this area.",
          address: "Mountain Path, Palayan Road, Phlippines",
          category: "road",
          lat: 6.672,
          lng: 131.047,
          severity: "medium",
          tags: ["road", "slippery", "accident"],
          streetView: "img/4.jpeg",
          streetName: "Mountain Path, Palayan Road",
          streetDescription:
            "Unpaved mountain road with steep inclines. Becomes dangerously slippery during rain. Limited guard rails.",
        },
        {
          id: 5,
          name: "Section 5 (Erosion Risk)",
          description:
            "Significant soil erosion along the riverbank. Risk of collapse during heavy rains.",
          address: "Riverside, Palayan Road, Philipines",
          category: "environmental",
          lat: 0,
          lng: 138.1,
          severity: "medium",
          tags: ["erosion", "river", "environmental"],
          streetView: "img/5.jpeg",
          streetName: "Riverside, Palayan Road",
          streetDescription:
            "Riverbank area showing significant erosion. Nearby structures may be at risk during flooding events.",
        },
      ];

      // Create markers and add to map
      const markers = [];
      const markersGroup = L.layerGroup().addTo(map);

      function getHazardColor(category) {
        switch (category) {
          case "fire":
            return "#f30a06";
          case "flood":
            return "#4c00ff";
          case "structural":
            return "#ff9900";
          case "road":
            return "#555555";
          case "environmental":
            return "#00aa00";
          default:
            return "#333333";
        }
      }

      function addMarkers(filteredHazards) {
        markersGroup.clearLayers();
        markers.length = 0;
        filteredHazards.forEach((hazard) => {
          const color = getHazardColor(hazard.category);
          const size = hazard.severity === "high" ? 10 : 8;

          // For custom image, use custom coordinates
          const x = (hazard.lng - 121.0) * 100;
          const y = (14.7 - hazard.lat) * 100;

          const marker = L.circleMarker([y, x], {
            radius: size,
            fillColor: color,
            color: "#fff",
            weight: 1,
            opacity: 1,
            fillOpacity: 0.8,
          }).addTo(markersGroup);

          marker.bindTooltip(hazard.name, {
            permanent: false,
            direction: "top",
          });

          marker.on("click", () => {
            showInfoPanel(hazard);
          });

          markers.push({ marker, hazard });
        });
      }

      // Show info panel with hazard details
      const infoPanel = document.getElementById("info-panel");
      const placeNameEl = document.getElementById("place-name");
      const placeAddressEl = document.getElementById("place-address");
      const placeDescriptionEl = document.getElementById("place-description");
      const hazardTagsEl = document.getElementById("hazard-tags");
      const closeInfoBtn = document.getElementById("close-info");
      const viewStreetBtn = document.getElementById("view-street-btn");

      let currentHazard = null;

      function showInfoPanel(hazard) {
        currentHazard = hazard;
        placeNameEl.textContent = hazard.name;
        placeAddressEl.textContent = hazard.address;
        placeDescriptionEl.textContent = hazard.description;

        // Create hazard tags
        hazardTagsEl.innerHTML = "";
        hazard.tags.forEach((tag) => {
          const span = document.createElement("span");
          span.classList.add("hazard-tag", `hazard-${tag}`);
          span.textContent = tag;
          hazardTagsEl.appendChild(span);
        });

        infoPanel.style.display = "block";

        // Center map on hazard
        const x = (hazard.lng - 121.0) * 100;
        const y = (14.7 - hazard.lat) * 100;
        map.setView([y, x], 1);
      }

      closeInfoBtn.addEventListener("click", () => {
        infoPanel.style.display = "none";
        currentHazard = null;
      });

      // Street view modal functionality
      const streetModal = document.getElementById("street-modal");
      const modalClose = document.getElementById("modal-close");
      const streetNameEl = document.getElementById("street-name");
      const streetImageEl = document.getElementById("street-image");
      const streetDescriptionEl = document.getElementById("street-description");
      const modalHazardsEl = document.getElementById("modal-hazards");

      viewStreetBtn.addEventListener("click", () => {
        if (!currentHazard) return;

        streetNameEl.textContent = currentHazard.streetName;
        streetImageEl.src = currentHazard.streetView;
        streetDescriptionEl.textContent = currentHazard.streetDescription;

        // Create hazard tags for modal
        modalHazardsEl.innerHTML = "";
        currentHazard.tags.forEach((tag) => {
          const span = document.createElement("span");
          span.classList.add("hazard-tag", `hazard-${tag}`);
          span.textContent = tag;
          modalHazardsEl.appendChild(span);
        });

        streetModal.classList.add("active");
      });

      modalClose.addEventListener("click", () => {
        streetModal.classList.remove("active");
      });

      // Close modal when clicking outside
      streetModal.addEventListener("click", (e) => {
        if (e.target === streetModal) {
          streetModal.classList.remove("active");
        }
      });

      // Populate hazards list in sidebar
      const placesList = document.querySelector(".places-list");

      function populatePlacesList(filteredHazards) {
        placesList.innerHTML = "";
        if (filteredHazards.length === 0) {
          placesList.innerHTML = "<p>No hazards found.</p>";
          return;
        }
        filteredHazards.forEach((hazard) => {
          const placeItem = document.createElement("div");
          placeItem.classList.add("place-item");
          placeItem.dataset.id = hazard.id;

          placeItem.innerHTML = `
                    <div class="place-info">
                        <h3>${hazard.name}</h3>
                        <p>${hazard.description.substring(0, 60)}...</p>
                    </div>
                `;

          placeItem.addEventListener("click", () => {
            showInfoPanel(hazard);
            // Highlight marker
            const markerObj = markers.find((m) => m.hazard.id === hazard.id);
            if (markerObj) {
              const x = (hazard.lng - 121.0) * 100;
              const y = (14.7 - hazard.lat) * 100;
              map.setView([y, x], 1);
              markerObj.marker.openTooltip();
            }
          });

          placesList.appendChild(placeItem);
        });
      }

      // Category filtering
      const categoryElements = document.querySelectorAll(".category");

      categoryElements.forEach((catEl) => {
        catEl.addEventListener("click", () => {
          categoryElements.forEach((el) => el.classList.remove("active"));
          catEl.classList.add("active");
          const category = catEl.dataset.category;
          filterHazards(category);
        });
      });

      function filterHazards(category) {
        let filtered;
        if (category === "all") {
          filtered = hazards;
        } else {
          filtered = hazards.filter((h) => h.category === category);
        }
        addMarkers(filtered);
        populatePlacesList(filtered);
        infoPanel.style.display = "none";
      }

      // Search functionality
      const searchInput = document.getElementById("search-input");
      const searchBtn = document.getElementById("search-btn");

      searchBtn.addEventListener("click", () => {
        const query = searchInput.value.trim().toLowerCase();
        if (!query) {
          // If empty, reset to current category filter
          const activeCategory =
            document.querySelector(".category.active").dataset.category;
          filterHazards(activeCategory);
          return;
        }
        const filtered = hazards.filter(
          (h) =>
            h.name.toLowerCase().includes(query) ||
            h.description.toLowerCase().includes(query) ||
            h.address.toLowerCase().includes(query) ||
            h.tags.some((tag) => tag.toLowerCase().includes(query))
        );
        addMarkers(filtered);
        populatePlacesList(filtered);
        infoPanel.style.display = "none";
      });

      // Map controls
      document.getElementById("zoom-in").addEventListener("click", () => {
        map.zoomIn();
      });

      document.getElementById("zoom-out").addEventListener("click", () => {
        map.zoomOut();
      });

      document.getElementById("locate-me").addEventListener("click", () => {
        alert(
          "Location feature would use coordinates relative to your custom map"
        );
      });

      document.getElementById("report-btn").addEventListener("click", () => {
        alert("Hazard reporting feature would open here");
      });

      // Sidebar toggle
      const sidebar = document.getElementById("sidebar");
      const toggleSidebarBtn = document.getElementById("toggle-sidebar");
      toggleSidebarBtn.addEventListener("click", () => {
        sidebar.classList.toggle("hidden");
        toggleSidebarBtn.classList.toggle("sidebar-hidden");
        // Change icon direction
        const icon = toggleSidebarBtn.querySelector("i");
        if (sidebar.classList.contains("hidden")) {
          icon.classList.remove("fa-chevron-left");
          icon.classList.add("fa-chevron-right");
        } else {
          icon.classList.remove("fa-chevron-right");
          icon.classList.add("fa-chevron-left");
        }
      });

      // Full screen toggle
      const fullscreenToggle = document.getElementById("fullscreen-toggle");
      let isFullscreen = false;

      fullscreenToggle.addEventListener("click", () => {
        if (isFullscreen) {
          // Exit full screen
          sidebar.classList.remove("hidden");
          toggleSidebarBtn.classList.remove("sidebar-hidden");
          toggleSidebarBtn.style.display = "flex";
          fullscreenToggle.innerHTML =
            '<i class="fas fa-expand"></i> Full Screen';
        } else {
          // Enter full screen
          sidebar.classList.add("hidden");
          toggleSidebarBtn.classList.add("sidebar-hidden");
          toggleSidebarBtn.style.display = "none";
          fullscreenToggle.innerHTML =
            '<i class="fas fa-compress"></i> Exit Full Screen';
        }
        isFullscreen = !isFullscreen;

        // Trigger map resize to ensure proper rendering
        setTimeout(() => {
          map.invalidateSize();
        }, 300);
      });

      // Initialize with all hazards
      addMarkers(hazards);
      populatePlacesList(hazards);
    </script>
  </body>
</html>
